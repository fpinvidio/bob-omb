@(message: String) @main("PLiP Administration Panel") {
<script>
	$(function() {
		$('#inner_content_div').slimScroll({
			height : '250px'
		});
	});
</script>
<div class="row">
	<div class="page-header">
		<ol class="breadcrumb">
			<li><a href="/">Home</a></li>
			<li class="active">Monitor</li>
		</ol>
		<h1>Monitor</h1>
	</div>
	<div class="col-md-8">
		<div class="progress active progress-striped">
			<div class="progress-bar progress-bar-success" style="width: 35%">
				<span class="sr-only">35% Complete (success)</span>
			</div>
			<div class="progress-bar progress-bar-warning" style="width: 20%">
				<span class="sr-only">20% Complete (warning)</span>
			</div>
			<div class="progress-bar progress-bar-danger" style="width: 10%">
				<span class="sr-only">10% Complete (danger)</span>
			</div>
		</div>
		<div class="media">
			<a class="pull-left" href="#"> <img id="page_image"
				class="media-object" src="http://placehold.it/150x100">
			</a>
			<div class="media-body">
				<h4 class="media-heading">Information</h4>
				<dl>
					<dt>Client</dt>
					<dd id="client_label">Not available</dd>
					<dt>Date</dt>
					<dd id="date_label">Not available</dd>
				</dl>
			</div>
		</div>
		<div>
			<h4>Products</h4>
			<ul id="products_list">
				<i>No data available.</i>
			</ul>
		</div>
	</div>
	<div class="col-md-4">
		<div class="portlet box blue">
			<div class="portlet-title">
				<div class="caption">Recent Activity</div>
			</div>
			<div class="portlet-body">
				<div id="inner_content_div" class="scroller">
					<ul class="feeds" id="live_feed">
						<li id="first_line">No activity detected.</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<script type="text/javascript" charset="utf-8">
		function buildFeed(page) {
			var resultHTML = '<li><div class="col-md-8"><span class="glyphicon glyphicon-bullhorn"></span> '
					+ 'Order Arrived - '
					+ page.order.code
					+ '</div><div class="col-md-4 abbr_time"><i><abbr class="timeago" title="'
					+ new Date().toISOString() + '"></abbr></i></div></li>';
			return resultHTML;
		}
		function setOrderFields(page) {
			$("#client_label").html(page.order.client);
			$("#date_label").html(new Date(page.order.insert_date).toString());
			if (page.page_image != null)
				$("#page_image").attr("src", page.page_image);
			var products_array = page.page_products;
			$("#products_list").html("");
			products_array.forEach(function(entry) {
				$("#products_list").append(
						"<li>" + entry.quantity + "x " + entry.product.name
								+ "</li>");
			});
		}
		$(function() {
			var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
			var dateSocket = new WS(
					"@routes.MonitorController.messageWs().webSocketURL(request)")

			var receiveEvent = function(event) {
				$("#first_line").hide();
				var result = JSON.parse(JSON.parse(event.data).text);
				switch (result.type) {
				case "page":
					$("#live_feed").append(buildFeed(result.object));
					jQuery("abbr.timeago").timeago();
					jQuery.timeago(new Date());
					setOrderFields(result.object);
					break;
				case "status":
					break;
				}
			}

			dateSocket.onmessage = receiveEvent
		});
	</script>
</div>
}
